<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>배우 프로필</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple SD Gothic Neo, Noto Sans KR, 'Malgun Gothic', sans-serif; line-height:1.6; }
.wrap { max-width:980px; margin:24px auto; padding:0 12px; }
h1 { font-size:28px; margin:0 0 16px; }
.ctrls { display:flex; gap:8px; margin-bottom:12px; }
.ctrls a { padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px; background:#fff; text-decoration:none; color:#111827; }
.note { color:#6b7280; }
ul.list { list-style:none; padding:0; margin:12px 0; }
li { padding:6px 0; border-bottom:1px dashed #e5e7eb; }
</style>
</head>
<body>
<div class="wrap">
  <div class="ctrls">
    <a href="index.html">홈</a>
    <a href="search.html">영화 검색</a>
    <a href="people-search.html">배우 검색</a>
    <a href="saved.html">저장 목록</a>
  </div>

  <h1 id="title">배우 프로필</h1>
  <div class="note">출연작 (최신 개봉일 순)</div>
  <ul id="out" class="list"></ul>
  <div id="msg" class="note"></div>
</div>

<script>
const BASE = location.pathname.replace(/\/[^\/]*$/, '');
const PEOPLE_URL = `${BASE}/data/search/people.json?v=${Date.now()}`;

function getParam(k){ return new URL(location.href).searchParams.get(k) || ""; }

let PEOPLE = [];

async function loadIndex(){
  const r = await fetch(PEOPLE_URL);
  if(!r.ok){ PEOPLE = []; return; }
  const j = await r.json();
  PEOPLE = j.people || [];
}

function render(){
  const cd = getParam('peopleCd') || '';
  const nm = getParam('peopleNm') || '';
  let item = null;

  if (cd) {
    item = PEOPLE.find(p => p.peopleCd === cd);
  }
  if (!item && nm) {
    item = PEOPLE.find(p => p.peopleNm === nm);
  }

  const out = document.getElementById('out');
  const title = document.getElementById('title');
  const msg = document.getElementById('msg');

  if (!item) {
    title.textContent = '배우 프로필';
    msg.textContent = '배우를 찾을 수 없어요. (캐시 인덱스 확인)';
    return;
  }

  title.textContent = item.peopleNm;
  out.innerHTML = '';
  for (const f of (item.films||[])) {
    const date = f.openDt ? `${f.openDt.slice(0,4)}.${f.openDt.slice(4,6)}.${f.openDt.slice(6,8)}` : '개봉일미상';
    const li = document.createElement('li');
    li.innerHTML = `<a href="detail.html?movieCd=${encodeURIComponent(f.movieCd)}">${f.movieNm}</a>
      <span class="note">(${date}${f.part? ' · '+f.part:''})</span>`;
    out.appendChild(li);
  }
}
(async function main(){
  await loadIndex();
  render();
})();
</script>
</body>
</html>
