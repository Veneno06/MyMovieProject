<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>배우 프로필</title>
  <link rel="stylesheet" href="assets/style.css"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body{max-width:900px;margin:2rem auto;padding:0 1rem;}
    .muted{color:#666}
    .btn{padding:.35rem .6rem;border:1px solid #bbb;border-radius:.4rem;background:#fff}
    .film{padding:.35rem 0;border-bottom:1px solid #eee}
    .badgel{display:inline-block;border:1px solid #ddd;padding:.12rem .4rem;border-radius:.4rem;margin-left:.35rem;font-size:.82rem;color:#666}
  </style>
</head>
<body>
  <h1>K-Movie A Archive</h1>

  <p>
    <a class="btn" href="index.html">홈</a>
    <a class="btn" href="search.html">영화 검색</a>
    <a class="btn" href="people-search.html">배우 검색</a>
    <a class="btn" href="saved.html">저장 목록</a>
  </p>

  <h2>배우 프로필</h2>
  <div id="header" class="muted">로딩 중…</div>

  <h3>출연작 (최신 개봉일 순)</h3>
  <div id="films"></div>

  <p><button class="btn" onclick="history.back()">← 뒤로가기</button></p>

<script>
const P_URL = "data/search/people.json";

function ymd(s){ if(!s||s.length!==8) return ""; return s.slice(0,4)+"-"+s.slice(4,6)+"-"+s.slice(6,8); }

function byQS(name){ return new URL(location.href).searchParams.get(name) || ""; }

let PEOPLE = [];

async function load(){
  const res = await fetch(P_URL, {cache:"no-store"});
  const j = await res.json();
  PEOPLE = j.people || [];
}

function show(){
  const peopleCd = byQS("peopleCd");
  const peopleNm = byQS("peopleNm");

  let row = null;

  if(peopleCd){
    row = PEOPLE.find(p=> (p.peopleCd||"") === peopleCd);
  }
  if(!row && peopleNm){
    // 동명이인 여러 명이면 첫 번째를 사용(페이지 상단에 안내)
    const candidates = PEOPLE.filter(p=> (p.peopleNm||"") === peopleNm);
    row = candidates[0] || null;
  }

  const header = document.querySelector("#header");
  const films = document.querySelector("#films");

  if(!row){
    header.innerHTML = `<span class="muted">배우를 찾을 수 없어요. (캐시 인덱스 확인)</span>`;
    films.innerHTML = "";
    return;
  }

  header.innerHTML = `<strong>${row.peopleNm}</strong> 
    <span class="badgel">${row.repRoleNm || "역할미상"}</span>
    ${peopleCd ? "" : `<span class="muted">※ 동명이인일 수 있어요.</span>`}`;

  if(!row.films || !row.films.length){
    films.innerHTML = `<p class="muted">필모그래피 없음</p>`;
    return;
  }

  // 최신 개봉일 순으로 이미 정렬되어 있음
  films.innerHTML = row.films.map(f=>{
    const link = `detail.html?movieCd=${encodeURIComponent(f.movieCd)}`;
    const when = f.openDt ? ` (${ymd(f.openDt)})` : "";
    const part = f.part ? ` <span class="muted">· ${f.part}</span>` : "";
    return `<div class="film"><a href="${link}">${f.movieNm}</a>${when}${part}</div>`;
  }).join("");
}

load().then(show);
</script>
</body>
</html>
