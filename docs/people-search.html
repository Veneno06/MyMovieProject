<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>배우 검색</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple SD Gothic Neo, Noto Sans KR, 'Malgun Gothic', sans-serif; line-height:1.6; }
.wrap { max-width:980px; margin:24px auto; padding:0 12px; }
h1 { font-size:28px; margin:0 0 16px; }
.ctrls { display:flex; gap:8px; margin-bottom:12px; }
.ctrls a { padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px; background:#fff; text-decoration:none; color:#111827; }
.note { color:#6b7280; }
ul.list { list-style:none; padding:0; margin:12px 0; }
li { padding:6px 0; border-bottom:1px dashed #e5e7eb; }
label { margin-right:8px; }
</style>
</head>
<body>
<div class="wrap">
  <div class="ctrls">
    <a href="index.html">홈</a>
    <a href="search.html">영화 검색</a>
    <a href="people-search.html">배우 검색</a>
    <a href="saved.html">저장 목록</a>
  </div>

  <h1>배우 검색</h1>

  <form id="f" class="box">
    이름: <input type="text" name="q" value="">
    <label><input type="checkbox" name="actorOnly" checked> 배우만</label>
    <button type="submit">검색</button>
  </form>

  <div id="total" class="note"></div>
  <ul id="out" class="list"></ul>
</div>

<script>
const BASE = location.pathname.replace(/\/[^\/]*$/, '');
const PEOPLE_URL = `${BASE}/data/search/people.json?v=${Date.now()}`;

let PEOPLE = [];

async function loadIndex(){
  const r = await fetch(PEOPLE_URL);
  if(!r.ok){ PEOPLE = []; return; }
  const j = await r.json();
  PEOPLE = j.people || [];
}

function search(){
  const f = new FormData(document.getElementById('f'));
  const q = (f.get('q')||'').trim();
  const actorOnly = f.get('actorOnly') !== null;

  let list = PEOPLE;
  if (actorOnly) list = list.filter(p => (p.repRoleNm||'') === '배우');
  if (q) list = list.filter(p => (p.peopleNm||'').includes(q));

  list = list.slice(0, 200);

  document.getElementById('total').textContent = `총 ${list.length}명 검색됨 (캐시)`;
  const ul = document.getElementById('out');
  ul.innerHTML = '';
  for (const p of list) {
    // peopleCd 없으면 이름 기반 링크로 폴백
    const href = p.peopleCd
      ? `person.html?peopleCd=${encodeURIComponent(p.peopleCd)}`
      : `person.html?peopleNm=${encodeURIComponent(p.peopleNm)}`;
    const li = document.createElement('li');
    li.innerHTML = `<a href="${href}">${p.peopleNm}</a> <span class="note">${p.repRoleNm||''}</span>`;
    ul.appendChild(li);
  }
}

(async function main(){
  await loadIndex();
  const f = document.getElementById('f');
  f.addEventListener('submit', (e)=>{ e.preventDefault(); search(); });
  search();
})();
</script>
</body>
</html>
